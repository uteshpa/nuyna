# Sprint 9 完了検証テストシナリオ

**プロジェクト:** nuyna (Creator's Privacy Toolkit)  
**スプリント:** Sprint 9 - パフォーマンス最適化  
**作成日:** 2026年1月8日  
**目的:** Sprint 9の完了定義（Definition of Done）がすべて満たされていることを確認する。

---

## 1. 検証概要

本シナリオは、Sprint 9で実装されたコード、ビルド、および既存テストの品質を担保するための検証手順を定義します。パフォーマンス測定（DoD-9-04）に関する詳細な手順は、別紙「パフォーマンス測定シナリオ」に記載します。

| DoD Criteria | 検証項目 | 担当者 | 結果 |
| :--- | :--- | :--- | :--- |
| **DoD-9-01** | 実装コードレビュー | リードエンジニア | ☐ Pass / ☐ Fail |
| **DoD-9-02** | iOS/Androidビルド | CI/CD or 開発者 | ☐ Pass / ☐ Fail |
| **DoD-9-03** | ユニット/ウィジェットテスト | CI/CD or 開発者 | ☐ Pass / ☐ Fail |

---

## 2. 検証シナリオ詳細

### 2.1. DoD-9-01: 実装コードレビュー

**目的:** Sprint 9で実装された3つの最適化タスク（T9-01, T9-02, T9-03）のコードが、技術仕様通りに正しく実装されていることを確認する。

| テストケースID | 検証手順 | 期待される結果 |
| :--- | :--- | :--- |
| **TC-CODE-01** | **Git履歴の確認**<br>1. `git log` を実行し、Sprint 9に関連するコミット（例: `0540567`）を特定する。 | Sprint 9の最適化内容を示すコミットメッセージが存在すること。 |
| **TC-CODE-02** | **T9-01: 並列処理の実装レビュー**<br>1. `lib/domain/usecases/process_media_usecase.dart` を開く。<br>2. フレーム処理ループが `Future.wait` を使用して並列化されていることを確認する。<br>3. 並列数が `AppConstants.maxConcurrentFrames` に基づいていることを確認する。 | コードが技術仕様通りに実装されていること。フレームの順序が維持されるロジックになっていること。 |
| **TC-CODE-03** | **T9-02: 画像フォーマット最適化レビュー**<br>1. FFmpegのコマンド生成部分を確認する。<br>2. 中間フレームのフォーマットがJPEGに設定されていることを確認する。<br>3. エンコードプリセットが `fast` に、CRF値が `23` に設定されていることを確認する。 | コードが技術仕様通りに実装されていること。JPEG品質が95%に設定されていること。 |
| **TC-CODE-04** | **T9-03: DIオーバーヘッド削減レビュー**<br>1. `process_media_usecase.dart` 内で、`_scrubUseCase` や `_obfuscateUseCase` がどのようにインスタンス化されているか確認する。 | ユースケースのインスタンスがコンストラクタで一度だけ取得（キャッシュ）され、フレームごとの `getIt()` 呼び出しが削除されていること。 |

### 2.2. DoD-9-02: プロジェクトビルド

**目的:** コード変更後も、iOSおよびAndroidの両プラットフォームでプロジェクトが正常にビルドできることを確認する。

| テストケースID | 検証手順 | 期待される結果 |
| :--- | :--- | :--- |
| **TC-BUILD-01** | **Androidビルド**<br>1. ターミナルでプロジェクトのルートディレクトリに移動する。<br>2. `flutter build apk` を実行する。 | コマンドがエラーなく正常に完了し、ビルド成果物（APKファイル）が生成されること。 |
| **TC-BUILD-02** | **iOSビルド**<br>1. ターミナルでプロジェクトのルートディレクトリに移動する。<br>2. `flutter build ios --no-codesign` を実行する。 | コマンドがエラーなく正常に完了し、ビルド成果物（.appファイル）が生成されること。 |

### 2.3. DoD-9-03: 既存テストのパス

**目的:** パフォーマンス最適化のためのリファクタリングによって、既存の機能にデグレード（機能低下）が発生していないことを確認する。

| テストケースID | 検証手順 | 期待される結果 |
| :--- | :--- | :--- |
| **TC-TEST-01** | **ユニット/ウィジェットテストの実行**<br>1. ターミナルでプロジェクトのルートディレクトリに移動する。<br>2. `flutter test` を実行する。 | すべてのテスト（136件）がパスし、`All tests passed!` と表示されること。 |
