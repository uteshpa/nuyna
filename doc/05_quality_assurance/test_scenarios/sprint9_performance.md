# Sprint 9 パフォーマンス測定シナリオ (DoD-9-04 検証)

**プロジェクト:** nuyna (Creator's Privacy Toolkit)  
**スプリント:** Sprint 9 - パフォーマンス最適化  
**作成日:** 2026年1月8日  
**目的:** Sprint 9の最重要完了定義（DoD-9-04）である「1分間の動画を30秒以内に処理する」を検証するための、正確かつ再現可能な測定手順を定義する。

---

## 1. 測定概要

本シナリオは、Sprint 9で最適化された動画処理パイプラインの性能を実機で測定するためのものです。測定は、客観性と再現性を担保するため、標準化された手順とテスト資産を用いて行います。

- **対象タスク:** T9-04: Performance Measurement
- **成功基準:** 処理時間が30秒以下であること。

---

## 2. 準備

### 2.1. テストデバイス

性能の異なる複数のデバイスで測定し、結果を比較することを強く推奨します。

- **推奨デバイス例:**
    - **ハイエンド:** iPhone 15 (iOS 19.x), Google Pixel 8 Pro (Android 16)
    - **ミドルレンジ:** iPhone SE 第3世代 (iOS 19.x), Google Pixel 7a (Android 16)

### 2.2. テスト用動画ファイル

- **ファイル名:** `standard_test_video_1min.mp4`
- **仕様:**
    - **長さ:** 正確に60秒 (01:00.00)
    - **解像度:** 1920x1080 (Full HD)
    - **フレームレート:** 30fps
    - **内容:** 街中を歩くシーンなど、常に2〜3人の顔が映り込んでいるもの。

### 2.3. テスト対象ビルド

- **コミットハッシュ:** `0540567` (perf: Sprint 9 - Performance Optimization)
- **ビルドモード:** プロファイルモード (`flutter run --profile`) を使用して、Flutter DevToolsに接続可能な状態で測定します。

### 2.4. 測定ツール

- **時間測定:** 物理的なストップウォッチ、またはPCの時計アプリ。
- **リソース監視:** Flutter DevTools (CPU Profiler, Memory)

---

## 3. 測定手順

各デバイスで、以下の手順を**最低3回**実施し、その平均値を記録します。

1.  **デバイスの準備:**
    1.  他のアプリをすべて終了させ、デバイスを再起動する。
    2.  機内モードをオンにし、Wi-FiとBluetoothをオフにする（外部からの影響を遮断するため）。
    3.  `standard_test_video_1min.mp4` をデバイスのストレージ（写真/ギャラリーアプリからアクセス可能）に転送する。

2.  **アプリの起動と接続:**
    1.  PCのターミナルで `flutter run --profile` を実行し、対象デバイスでアプリを起動する。
    2.  表示されたURLをブラウザで開き、Flutter DevToolsに接続する。
    3.  CPU ProfilerとMemoryのタブを開いておく。

3.  **測定の実行:**
    1.  ストップウォッチをリセットする。
    2.  nuynaアプリで動画選択画面を開く。
    3.  **ストップウォッチの開始と同時に**、`standard_test_video_1min.mp4` をタップ（選択）する。
    4.  アプリが動画処理を開始する。
        *（注: 現状のUIでは、動画選択から即時処理が開始されることを想定。もし処理開始ボタンがある場合は、そのボタンをタップすると同時にストップウォッチを開始する）*
    5.  処理が完了し、保存または共有の画面が表示されたら、**即座にストップウォッチを停止**する。

4.  **結果の記録:**
    1.  ストップウォッチに表示された時間（秒）を記録用紙に記入する。
    2.  Flutter DevToolsのCPU/Memoryプロファイラから、処理中のピーク値や特徴的なパターンをスクリーンショットで保存する。
    3.  処理後の動画を再生し、顔が正しくぼかされているか、音声が正常かなど、簡単な目視確認を行う。

---

## 4. データ記録フォーマット

以下のテーブル形式で結果を記録します。

**デバイス:** iPhone 15 (iOS 19.2)

| 試行回数 | 処理時間 (秒) | クラッシュ/エラー | CPUピーク | メモリピーク | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | | なし / あり | | | |
| 2 | | なし / あり | | | |
| 3 | | なし / あり | | | |
| **平均** | | | | | |

**デバイス:** Google Pixel 8 Pro (Android 16)

| 試行回数 | 処理時間 (秒) | クラッシュ/エラー | CPUピーク | メモリピーク | 備考 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | | なし / あり | | | |
| 2 | | なし / あり | | | |
| 3 | | なし / あり | | | |
| **平均** | | | | | |

---

## 5. 成功/失敗の判定

- **成功 (Pass):**
    - すべてのテストデバイスで、3回試行の**平均処理時間が30.00秒以下**である。
    - 測定中にアプリのクラッシュやフリーズ、処理の失敗が一度も発生しない。

- **失敗 (Fail):**
    - 上記の成功基準を一つでも満たさない場合。
